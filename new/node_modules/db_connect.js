var mysql = require('mysql');
var connection = mysql.createConnection({
  host     : '127.0.0.1',
  user     : 'root',
  password : 'imsse57cxh',
  database : 'imperialBattles'
});

connection.connect();

// Get Data from the DB
var getUserData = function(userName, callback) {
	// connection.connect();
	connection.query('SELECT * FROM userids WHERE name = "' + userName + '"', function(err, rows, fields) {
		
		if (err) 
            callback(err,null);
        else
            callback(null,rows[0]);
	});
	// connection.end();
};

var getUserData1 = function(userId, callback) {
	// connection.connect();
	connection.query('SELECT * FROM userids WHERE id = "' + userId + '"', function(err, rows, fields) {
		
		if (err) 
            callback(err,null);
        else
            callback(null,rows[0]);
	});
	// connection.end();
};

var getResourceData = function(userId, callback) {
	// connection.connect();
	connection.query('SELECT * FROM userResources WHERE userID = "' + userId + '"', function(err, rows, fields) {
		// connection.end();
		if (err) 
            callback(err,null);
        else
            callback(null,rows[0]);
	});
};

// Add Data into DB
var addUserData = function(userName, password) {
	var data = {name : userName, password : password};
	// connection.connect();
	connection.query('INSERT INTO userids SET ?', data, function(err, result) {
		if (!err) {
			// console.log("The solution is : ", result);
		} else {
			console.log("Error while performing Query.");
		}
	});
	// connection.end();
};

var addResourceData = function(userId, wood, veg, meat, stone, iron, gold, people, horse, sheep, army, happiness, wars, developments, wheat) {
	var data = {userId:userId, wood:wood, veg:veg, meat:meat, stone:stone, iron:iron, gold:gold, people:people, horse:horse, sheep:sheep, army:army, happiness:happiness, wars:wars, developments:developments, wheat:wheat};
	// connection.connect();
	connection.query('INSERT INTO userResources SET ?', data, function(err, result) {
		if (!err) {
			// console.log("The solution is : ", result);
		} else {
			console.log("Error while performing Query.");
		}
	});
	// connection.end();
};


// Update data in DB,
var udpateResourceData = function(userId, wood, veg, meat, stone, iron, gold, people, horse, sheep, army, happiness, wars, developments, wheat) {
	var data = {wood:wood, veg:veg, meat:meat, stone:stone, iron:iron, gold:gold, people:people, horse:horse, sheep:sheep, army:army, happiness:happiness, wars:wars, developments:developments, wheat:wheat};
	// connection.connect();
	connection.query('UPDATE userResources SET ? WHERE userID = ?', [data, userId], function(err, result) {
		if (!err) {
			// console.log("The solution is : ", result);
		} else {
			console.log("Error while performing Query.");
		}
	});
	// connection.end();
};

var udpateResourceData1 = function(userId, army, happiness, gold) {
	var data = { gold:gold, army:army, happiness:happiness};
	// connection.connect();
	connection.query('UPDATE userResources SET ? WHERE userID = ?', [data, userId], function(err, result) {
		if (!err) {
			// console.log("The solution is : ", result);
		} else {
			console.log("Error while performing Query.");
		}
	});
	// connection.end();
};


// Delete data in DB
var deleteUserData = function(userId) {
	// connection.connect();
	connection.query('DELETE FROM userids WHERE userID ="' + userId +'"', function(err, result) {
		if (!err) {
			// console.log("The solution is : ", result);
		} else {
			console.log("Error while performing Query.");
		}
	});
	// connection.end();
};

var deleteResourceData = function(userId) {
	// connection.connect();
	connection.query('DELETE FROM userResources WHERE userID ="' + userId +'"', function(err, result) {
		if (!err) {
			// console.log("The solution is : ", result);
		} else {
			console.log("Error while performing Query.");
		}
	});
	// connection.end();
};




// exports
exports.getUserData = getUserData;
exports.getUserData1 = getUserData1;
exports.getResourceData = getResourceData;
exports.addUserData = addUserData;
exports.addResourceData = addResourceData;
exports.udpateResourceData = udpateResourceData;
exports.udpateResourceData1 = udpateResourceData1;
exports.deleteUserData = deleteUserData;
exports.deleteResourceData = deleteResourceData;